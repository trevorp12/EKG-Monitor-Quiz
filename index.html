<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECG Rhythm Quiz</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: #1e1e1e; color: #e0e0e0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        #header { max-width: 800px; width: 100%; text-align: center; margin-bottom: 20px; }
        #category-bar { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 15px; }
        .category-btn { background: #333; color: #fff; border: 1px solid #555; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .category-btn:hover, .category-btn.active { background: #00bfff; color: #1a1a1a; }
        #quiz-settings { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-bottom: 15px; }
        #quiz-settings select, #start-btn { padding: 8px 12px; border-radius: 6px; border: 1px solid #555; background: #2c2c2c; color: #e0e0e0; font-size: 14px; }
        #start-btn { background: #00ff7f; color: #1a1a1a; font-weight: bold; cursor: pointer; }
        #start-btn:hover { background: #00cc66; }
        #monitor { width: 100%; max-width: 800px; height: 200px; background: #2c2c2c; border: 2px solid #4a4a4a; border-radius: 8px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.6); }
        canvas { display: block; width: 100%; height: 100%; }
        #quiz-container { max-width: 600px; background: #2c2c2c; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.6); text-align: center; }
        #question { font-size: 20px; font-weight: bold; margin-bottom: 15px; }
        #options { list-style: none; margin: 0; padding: 0; }
        #options li { margin: 10px 0; padding: 12px; background: #3a3a3a; border: 1px solid #5a5a5a; border-radius: 6px; cursor: pointer; }
        #options li:hover { background: #4a4a4a; }
        #options li.selected { background: #00ff7f; color: #1a1a1a; font-weight: bold; }
        #feedback { margin-top: 20px; padding: 10px; background: #333; border-radius: 6px; min-height: 50px; }
        #score { font-size: 28px; font-weight: bold; margin: 20px 0; display: none; }
        button { background: #00ff7f; color: #1a1a1a; border: none; padding: 10px 20px; font-size: 16px; border-radius: 6px; cursor: pointer; font-weight: bold; margin: 10px 5px; }
        button:hover { background: #00cc66; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="header">
    <h1>ECG Rhythm Quiz</h1>
    <div id="category-bar">
        <button class="category-btn active" data-type="all">All Rhythms</button>
        <button class="category-btn" data-type="nsr">Normal Sinus</button>
        <button class="category-btn" data-type="sinusTach">Sinus Tach</button>
        <button class="category-btn" data-type="sinusBrad">Sinus Brad</button>
        <button class="category-btn" data-type="vFib">V-Fib</button>
        <button class="category-btn" data-type="vTach">V-Tach</button>
        <button class="category-btn" data-type="asystole">Asystole</button>
    </div>
    <div id="quiz-settings">
        <select id="question-count">
            <option value="10">10 Questions</option>
            <option value="15" selected>15 Questions</option>
            <option value="20">20 Questions</option>
            <option value="25">25 Questions</option>
        </select>
        <button id="start-btn">Start Quiz</button>
    </div>
</div>

<div id="monitor">
    <canvas id="ecg-canvas"></canvas>
</div>

<div id="quiz-container" class="hidden">
    <div id="question"></div>
    <ul id="options"></ul>
    <button id="submit-btn">Submit Answer</button>
    <button id="next-btn" class="hidden">Next Question</button>
    <div id="feedback"></div>
    <div id="score"></div>
</div>

<script>
    const canvas = document.getElementById('ecg-canvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    const speed = 2;
    const lineColor = '#00ff7f';
    let offset = 0;
    let currentRhythm = null;

    function resize() {
        width = canvas.clientWidth;
        height = canvas.clientHeight;
        canvas.width = width;
        canvas.height = height;
        drawGrid();
    }
    window.addEventListener('load', () => {
        resize();
        window.addEventListener('resize', resize);
    });

    function drawGrid() {
        ctx.clearRect(0, 0, width, height);
        ctx.strokeStyle = '#333'; ctx.lineWidth = 0.5;
        for (let x = 0; x < width; x += 10) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,height); ctx.stroke(); }
        for (let y = 0; y < height; y += 10) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(width,y); ctx.stroke(); }
        ctx.strokeStyle = '#444'; ctx.lineWidth = 1;
        for (let x = 0; x < width; x += 50) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,height); ctx.stroke(); }
        for (let y = 0; y < height; y += 50) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(width,y); ctx.stroke(); }
    }

    const rhythms = {
        nsr: [{name: 'NSR 70bpm', rate: 70, pr: 40, qrs: 20}],
        sinusTach: [{name: 'Sinus Tach 120bpm', rate: 120, pr: 30, qrs: 20}],
        vFib: [{name: 'Coarse VFib', freq: 300, amp: 30}],
        asystole: [{name: 'Asystole Flat', noise: 0}]
    };

    function makeRhythm(p, type) {
        return x => {
            let y = height / 2;
            const rate = p.rate || 60;
            const beat = width * 60 / rate / 10;
            const t = x % beat;
            if (type === 'vFib') y += (Math.random()-0.5)*p.amp*Math.sin(x*0.1);
            else if (type === 'asystole') y += (Math.random()-0.5)*p.noise;
            else {
                const prT = t - p.pr;
                y += Math.sin(t * 0.3) * 10;
                if (prT > 0 && prT < p.qrs) y -= 40;
                if (prT > p.qrs) y += Math.sin((prT - p.qrs) * 0.2) * 15;
            }
            return y;
        };
    }

    function animate() {
        ctx.drawImage(canvas, -speed, 0);
        ctx.clearRect(width - speed, 0, speed, height);
        for (let i = 0; i < speed; i++) {
            const x = width - speed + i;
            const y = currentRhythm ? currentRhythm((offset + x) % width) : height / 2;
            ctx.strokeStyle = lineColor; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x, y); ctx.stroke();
        }
        offset = (offset + speed) % width;
        requestAnimationFrame(animate);
    }
    animate();

    let category = 'all', totalQ = 15, q = 0, score = 0, selected = -1, quiz = [], correctIdx = 0;

    document.querySelectorAll('.category-btn').forEach(b => b.addEventListener('click', () => {
        document.querySelectorAll('.category-btn').forEach(bb => bb.classList.remove('active'));
        b.classList.add('active');
        category = b.dataset.type;
    }));

    document.getElementById('start-btn').onclick = () => {
        totalQ = +document.getElementById('question-count').value;
        const pool = category === 'all' ? Object.values(rhythms).flat() : rhythms[category] || [];
        quiz = Array(totalQ).fill().map(() => {
            const r = pool[Math.floor(Math.random() * pool.length)];
            return {name: r.name, type: category === 'all' ? getType(r.name) : category, p: r};
        });
        q = 0; score = 0;
        document.getElementById('quiz-container').classList.remove('hidden');
        document.getElementById('start-btn').style.display = 'none';
        document.getElementById('quiz-settings').style.display = 'none';
        loadQ();
    };

    function getType(n) { for (const [t, a] of Object.entries(rhythms)) if (a.some(r => r.name === n)) return t; return 'nsr'; }

    function loadQ() {
        const r = quiz[q];
        currentRhythm = makeRhythm(r.p, r.type);
        document.getElementById('question').textContent = `Q${q+1}/${totalQ}: Identify the rhythm.`;
        const opts = [r.name, ...getDistractors(r.name)];
        opts.sort(() => Math.random() - 0.5);
        correctIdx = opts.indexOf(r.name);
        const ul = document.getElementById('options'); ul.innerHTML = '';
        opts.forEach((o, i) => {
            const li = document.createElement('li');
            li.textContent = o;
            li.onclick = () => select(i);
            ul.appendChild(li);
        });
        document.getElementById('feedback').innerHTML = '';
        document.getElementById('submit-btn').classList.remove('hidden');
        document.getElementById('next-btn').classList.add('hidden');
        selected = -1;
    }

    function getDistractors(c) {
        return Object.values(rhythms).flat().filter(r => r.name !== c).sort(() => Math.random() - 0.5).slice(0,3).map(r => r.name);
    }

    function select(i) {
        document.querySelectorAll('#options li').forEach((li, j) => li.classList.toggle('selected', j === i));
        selected = i;
    }

    document.getElementById('submit-btn').onclick = () => {
        if (selected === -1) return alert('Select an answer!');
        const fb = document.getElementById('feedback');
        if (selected === correctIdx) { score++; fb.innerHTML = `<span style="color:#00ff7f;">Correct!</span>`; }
        else fb.innerHTML = `<span style="color:#ff4d4d;">Wrong.</span> Correct: ${document.querySelectorAll('#options li')[correctIdx].textContent}`;
        document.getElementById('submit-btn').classList.add('hidden');
        document.getElementById('next-btn').classList.remove('hidden');
    };

    document.getElementById('next-btn').onclick = () => {
        q++;
        if (q < totalQ) loadQ();
        else {
            document.getElementById('quiz-container').innerHTML = `<h1>Quiz Complete!</h1><div id="score">Score: ${score}/${totalQ}</div><button onclick="location.reload()">Restart</button>`;
        }
    };
</script>
</body>
</html>